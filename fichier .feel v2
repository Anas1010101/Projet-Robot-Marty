from marty import Marty 
import re

def parse_feels_file(filename):
    """Parse .feels file into config dictionary"""   
    configs = {}
    with open(filename, 'r') as file:
        for line in file:
            line = line.split('#')[0].strip()
            if not line:
                continue
            
            match = re.match(r'(\w+);(\w+);([0-9a-fA-F]{6})', line)
            if match:
                color, animation, hex_rgb = match.groups()
                rgb = tuple(int(hex_rgb[i:i+2], 16) for i in (0, 2, 4))
                configs[animation] = {
                    'color': color,
                    'rgb': rgb,
                    'animation': animation
                }
    return configs

def set_marty_eyes(marty, config_name, eye_configs):
    """Set Marty's eyes using disco_color"""
    if config_name in eye_configs:
        config = eye_configs[config_name]
        
        # Set color using disco_color
        marty.disco_color(config['color'])  # Using color name
    else:
        print(f"Config '{config_name}' not found. Available: {list(eye_configs.keys())}")

# Usage
if __name__ == "__main__":
    eye_configs = parse_feels_file('real.feels')  
    marty = Marty.connect()
    
    try:
        set_marty_eyes(marty, "angry", eye_configs)  # la couleur sera rouge pour "angry"
        marty.arms(100, 100)  # Exemple d'action
        
        set_marty_eyes(marty, "excited", eye_configs)  # jaune pour "excited"
        marty.kick_left()  # Exemple d'action
        
    finally:
        marty.close()
